library(tidyverse)
library(completejourney)
#1 
redeem_coupon <- left_join(
  campaign_table %>% count(household_key),
  coupon_redempt %>% count(household_key), by = 'household_key')

redemption_rate <- mean(!is.na(redeem_coupon$n.y)) 

redemption_rate
#the redemption rate is 27.4% 

#2 
sum(is.na(redeem_coupon$n.y))
#1150 

#3 
coupon_count <- left_join(coupon %>% count(coupon_upc),
coupon_redempt %>% count(coupon_upc), by = 'coupon_upc') 

mean(!is.na(coupon_count$n.y))
#49% 

#4 
left_join(transaction_data, product) %>% 
  group_by(sub_commodity_desc, week_no) %>% 
  summarise(totalsales = sum(sales_value)) %>% 
  filter(week_no == 52 | week_no == 102) %>% 
  mutate(revenue_growth = ifelse(lag(totalsales) >= 100,
                                 (totalsales - lag(totalsales)) /
                                   lag(totalsales), NA)) %>% 
  arrange(desc(revenue_growth))

