---
Author: Mo Jmaileh
title: "Data Wrangling Exercises"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r load-packages, warning=FALSE, message=FALSE}
library(tidyverse)

library(completejourney)
```

---

**Question 1**:
What percentage of households redeemed at least 1 coupon from a mailed campaign? 


```{r}
coupon_count <- count(coupon_redempt, household_key)
households_redeemed<- campaign_table %>%
  distinct(household_key) %>%
  left_join(coupon_count, by='household_key')
mean(!is.na(households_redeemed$n))
```




---

**Question 2**:
How many households did not redeem a coupon? 


```{r}
coupon_count <- count(coupon_redempt, household_key)
households_not_redeemed<- campaign_table %>%
  distinct(household_key) %>%
  anti_join(coupon_count, by='household_key')
count(households_not_redeemed)

```

---

**Question 3**:
What was the most popular product bought with campaign coupons? 

```{r}
coupon_product_dta <- inner_join(coupon, product, by = "product_id")

cpn_prod_red <- inner_join(coupon_product_dta, coupon_redempt, by = c("campaign","coupon_upc"))

cpn_prod_red %>%
  count(sub_commodity_desc) %>%
  arrange(desc(n)) %>%
  filter(row_number() <=3)

```

---

**Question 4**:
Using the field `commodity_desc` determine which category spend grew the most? In 
order to calculate growth in sales, summarize the weekly spend per category 
then compare the first and last weeks.


 
```{r}
transaction_data %>%
  inner_join(product, by = c("product_id")) %>%
  group_by(commodity_desc, week_no) %>%
  summarise(total_sales = sum(sales_value, na.rm = TRUE))%>%
  arrange(commodity_desc, week_no) %>%
  group_by(commodity_desc) %>%
  filter(row_number() == 1 | row_number() == n()) %>%
  select(-week_no) %>%
  mutate(week_of_sale = ifelse(row_number() == 1, 'first', 'last')) %>%
  spread(key = week_of_sale, value = total_sales) %>%
  mutate(growth = (last - first) / first) %>%
  filter(first >= 100) %>%
  arrange(desc(growth))

#The top three growth categories are Fluid Milk Products, Frozen mean/meat dinners, and cheese in that order.
```
 
*This question grows your ability to create a pipeline of data transformation steps to generate results. Specific functions include: [`group_by()` and `summarize()`](http://r4ds.had.co.nz/transform.html#grouped-summaries-with-summarise), [`filter()`](http://r4ds.had.co.nz/transform.html#filter-rows-with-filter), [`mutate()`](http://r4ds.had.co.nz/transform.html#add-new-variables-with-mutate), [`select()`](http://r4ds.had.co.nz/transform.html#select-columns-with-select), [`spread()`](http://r4ds.had.co.nz/tidy-data.html#spreading), and [`arrange()`](http://r4ds.had.co.nz/transform.html#arrange-rows-with-arrange).*
