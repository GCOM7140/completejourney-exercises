---
title: "Data Wrangling Exercises"
author: "Richard Potter"
date: "04/17/18"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo = TRUE, eval = TRUE, message = FALSE}
library(tidyverse)
library(completejourney)
```

---

## Exercise 1:
**Question**: What percent of households that received the retailer's weekly mailer redeemed at least one coupon?

**Answer**:
``` {r}
left_join(campaign_table %>% count(household_key),
          coupon_redempt %>% count(household_key),
          by = "household_key")%>% 
  summarise(redrate = (mean(!is.na(n.y))))
```
---

## Exercise 2:
**Question**: How many households did not redeem a coupon?   

**Answer**:
```{r}
left_join(campaign_table %>% count(household_key),
          coupon_redempt %>% count(household_key),
          by = "household_key") %>% 
  summarise(redrate = (sum(is.na(n.y))))
```
---

## Exercise 3:
**Question**: What percent of coupons promoted in the retailer's weekly mailer got redeemed at least once?

**Answer**:
```{r}
left_join(
  coupon %>% 
  count(coupon_upc), coupon_redempt %>%
  count(coupon_upc), by = "coupon_upc") %>% 
  summarise(redrate = mean(!is.na(n.y)))
```
---

## Exercise 4:
**Question**: Using the `transaction_data` and `product` datasets, determine which product category (i.e., `sub_commodity_desc`) grew the most in terms of revenue for the retailer in the second half of the study period (i.e., between `week_no == 52` and `week_no == 102`). Only consider product categories that had over $100 in revenue in week 52, and calculate revenue growth as a percentage of category revenue in week 52.

**Answer**:

```{r}
left_join(transaction_data, product) %>% 
  group_by(sub_commodity_desc, week_no) %>% 
  summarise(totalsales = sum(sales_value)) %>% 
  filter(week_no == 52 | week_no == 102) %>% 
  mutate(revenue_growth = ifelse(lag(totalsales) >= 100,
                                 (totalsales - lag(totalsales)) /
                                  lag(totalsales), NA)) %>% 
  arrange(desc(revenue_growth))
```