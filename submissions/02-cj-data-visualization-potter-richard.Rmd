---
title: "Customer Journey Data Visualization Exercises"
author: "Richard Potter"
date: "4/2/2018"
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-packages, warning = FALSE, message = FALSE}
library(tidyverse)
library(completejourney)
```

---

**Question 1**: Create a histogram of `quantity`. What, if anything, do you find unusual about this visualization? 

**Answer**: 

This visualization includes many large numbers, toward 100,000, which means that almost all of the basket quantities are grouped around 0, rendering the information in the graph almost useless. In the end, I would adjust the bin width if I wanted to find meaningful information.

```{r Q1}
transaction_data <- transaction_data %>%
  select(
    quantity,
    sales_value,
    retail_disc, coupon_disc, coupon_match_disc,
    household_key, store_id, basket_id, product_id,
    week_no, day, trans_time
  )

transaction_data %>% 
  ggplot() +
  geom_histogram(aes(quantity))
```

---

**Question 2**: Use a line graph to plot total sales value by day. What, if anything, do you find unusual about this visualization?

**Answer**: 

There is far too much information in order for the graph to be meaningful, the lines are causing things to be much more frantic than for the size of the graph. I would either expand the size, find the sum by week, or run a geom_smooth.

```{r Q2}
transaction_data %>% 
  group_by(day, sales_value) %>% 
  summarise(totalsales = sum(sales_value)) %>% 
  ggplot() +
  geom_line(aes(day, totalsales))
```

---

**Question 3**: Use a bar graph to compare the total sales values of national and private-label brands. 

**Answer**:

```{r Q3}
my_transaction_data <- left_join(transaction_data, product, by = 'product_id')
my_transaction_data %>% 
  group_by(brand) %>%
  summarise(totalsalesbrand = sum(sales_value)) %>% 
  ggplot(aes(brand)) +
  geom_bar(aes(weight = totalsalesbrand, fill = brand))
```

---

**Question 4**: Building on Question 3, suppose you want to understand whether the retailer's customers' preference for national brands (compared to private-label brands) is stronger in the soft drink category than it is in the cheese category. Examine this supposition by using a stacked bar graph to compare the split between national and private-label brands for soft drinks and cheeses. 

**Answer**: 
```{r Q4}
my_transaction_data %>% 
  filter(commodity_desc %in% c("SOFT DRINKS", "CHEESE")) %>% 
  group_by(commodity_desc, brand) %>% 
  summarise(totalsalesproduct = sum(sales_value)) %>% 
  ggplot() + 
  geom_bar(aes(commodity_desc, weight = totalsalesproduct, fill = brand), position = 'fill')
```

---

**Question 5**: The code below filters `my_transaction_data` to include only peanut better, jelly, and jam transactions. Then it creates a new variable named `product_size` equal to product size in ounces. Create a bar graph with `pb_and_j_data` to visualize the distribution of the retailer's PB\&J transactions by product size. Which two product sizes are the most popular?

**Answer**:
18 and 32 ounces are the most popular product sizes.

```{r Q5}
pb_and_j_data <- my_transaction_data %>%
  filter(commodity_desc == 'PNT BTR/JELLY/JAMS') %>%
  mutate(product_size = as.factor(as.integer(gsub('([0-9]+)([[:space:]]*OZ)',
                                                '\\1', 
                                                curr_size_of_product)))) 
pb_and_j_data %>% 
  ggplot() + 
  geom_bar(aes(product_size))
```

