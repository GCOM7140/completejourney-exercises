---
title: "Data Transformation Exercises"
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The following five questions are based on concepts covered in 
[Chapter 5][chapter 5] of [R4DS][r4ds]. Answer them using `transaction_data` in
the Complete Journey data package and start by loading the `tidyverse` and 
`completejourney` packages.

```{r load-packages, warning = FALSE, message = FALSE, eval = FALSE}
library(tidyverse)
library(completejourney)

transaction_data <- transaction_data %>% 
  select(
    quantity,
    sales_value, 
    retail_disc, coupon_disc, coupon_match_disc,
    household_key, store_id, basket_id, product_id, 
    week_no, day, trans_time
  )
```

---

**Question 1**: Change the discount variables (i.e., `retail_disc`, 
`coupon_disc`, `coupon_match_disc`) from negative to positive. 

**Hint:** Use the `abs()` function within [`mutate()`][mutate]. 

This question is designed to strengthen your ability to use the `dplyr` 
verb [`mutate()`][mutate] to overwrite an existing variable.

---

**Question 2**: Create three new variables named `regular_price`, 
`loyalty_price`, and `coupon_price` according to the following logic:

```{r eval = FALSE}
regular_price = (sales_value + retail_disc + coupon_match_disc) / quantity
loyalty_price = (sales_value + coupon_match_disc) / quantity
coupon_price  = (sales_value - coupon_disc) / quantity
```


This question is designed to strengthen your ability to use the `dplyr` verb 
[`mutate()`][mutate] to create new variables from existing ones. It should also
help you develop a better understanding of the discount variables in 
`transaction_data`.

---

**Question 3**: The `transaction_data` covers 92,339 unique product IDs. How 
many unique products (not transactions!) had a regular price of one dollar or 
less? What does this count equal for loyalty price? 

**Hint:** After filtering, select the product id column and count unique 
products using the `n_distinct()` function. 

This question is designed to strengthen your ability to use the `dplyr` verb 
[`filter()`][filter].

---

**Question 4**: What proportion of baskets are over $10 in sales value? 

**Hint:** You need to use [`summarize()`][summarize], [`group_by()`][summarize], 
and [`ungroup()`][ungroup]. Summarize over all baskets. In the last step, you 
can calculate the proportion by taking the mean of `TRUE/FALSE` values. Use the 
code `mean(basket_value > 10)` to get the proportion over $10. 

This question is designed to strengthen your ability to use the `dplyr` verbs 
[`summarize()`][summarize] and [`ungroup()`][ungroup].

---

**Question 5**: Which store with over $10K in total `sales_value` discounts its 
products the most for loyal customers? 

**Hint:** You can calculate loyalty discount as a percentage of regular price 
using the following logic:

```{r eval = FALSE}
pct_loyalty_disc = 1 - (loyalty_price / regular_price)
```

This question is designed to strengthen your ability to use the `dplyr` verbs 
[`filter()`][filter], [`mutate()`][mutate], [`group_by()`][summarize], 
[`summarize()`][summarize], and [`arrange()`][arrange] (i.e., 
almost everything covered in [Chapter 5][chapter 5].

[chapter 5]: http://r4ds.had.co.nz/transform.html
[r4ds]: http://r4ds.had.co.nz/
[arrange]: http://r4ds.had.co.nz/transform.html#arrange-rows-with-arrange
[select]: http://r4ds.had.co.nz/transform.html#select-columns-with-select
[mutate]: http://r4ds.had.co.nz/transform.html#add-new-variables-with-mutate
[filter]: http://r4ds.had.co.nz/transform.html#filter-rows-with-filter
[summarize]: http://r4ds.had.co.nz/transform.html#grouped-summaries-with-summarise
[ungroup]: http://r4ds.had.co.nz/transform.html#ungrouping